---
title: "Simulation SimRevisionR2"
author: "Yenny Webb-Vargas"
date: "Wednesday, September 17, 2014"
output: html_document
---

This implements simulation for testing my functional mediation function. 

Load the library 'refund'. It also loads the library 'fda' among many others.
```{r}
library(refund)
source('~/GitHub/functional_mediation/fMediation_ML.R')
```

Load the canonical HRF function
```{r}
short_HRF <- read.table("C:/Users/Yenny/Documents/GitHub/functional_mediation/YennyHRF")
plot(1:length(short_HRF), short_HRF, type="l")
```

```{r}
Z = c(rep(0,20), short_HRF, rep(0,20))

sub=20
nbasis = 30
norder = 6

seed = 794320
set.seed(seed)
X = rep(0,sub)
X[sample(1:sub)[1:(floor(sub/2))]] = 2
X = X - 1 

M = sapply(1:sub, function(i) rnorm(n = length(Z),mean=0, sd=1))
Y = X + rnorm(sub, mean=0, sd=1)

write.csv(cbind(Y,X,t(M)), file=paste0("sim_",seed, ".csv"))

check = fMediation_ML(X,Y,M,nbasis,norder,lambda=1e-8)
```



